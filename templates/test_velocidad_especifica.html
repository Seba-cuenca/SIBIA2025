<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SIBIA - Prueba Velocidad Asistente y Calculadora</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .test-card {
            border-left: 4px solid #007bff;
            margin-bottom: 20px;
        }
        .metric-value {
            font-size: 1.5em;
            font-weight: bold;
            color: #007bff;
        }
        .success { color: #28a745; }
        .warning { color: #ffc107; }
        .error { color: #dc3545; }
        .log-container {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            padding: 15px;
            max-height: 300px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 0.9em;
        }
        .test-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        .progress-bar-custom {
            height: 25px;
            background: linear-gradient(90deg, #007bff, #28a745);
        }
    </style>
</head>
<body>
    <div class="container mt-4">
        <h1 class="mb-4">üöÄ SIBIA - Prueba de Velocidad Asistente y Calculadora</h1>
        
        <div class="row">
            <div class="col-md-6">
                <div class="card test-card">
                    <div class="card-header">
                        <h5><i class="fas fa-robot me-2"></i>Asistente IA</h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-6">
                                <div class="text-center">
                                    <div class="metric-value" id="asistente-init">0ms</div>
                                    <small>Inicializaci√≥n</small>
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="text-center">
                                    <div class="metric-value" id="asistente-respuesta">0ms</div>
                                    <small>Tiempo Respuesta</small>
                                </div>
                            </div>
                        </div>
                        <hr>
                        <div class="row">
                            <div class="col-6">
                                <div class="text-center">
                                    <div class="metric-value" id="asistente-voz">0ms</div>
                                    <small>S√≠ntesis Voz</small>
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="text-center">
                                    <div class="metric-value" id="asistente-cache">0</div>
                                    <small>Cache Hits</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="col-md-6">
                <div class="card test-card">
                    <div class="card-header">
                        <h5><i class="fas fa-calculator me-2"></i>Calculadora</h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-6">
                                <div class="text-center">
                                    <div class="metric-value" id="calculadora-materiales">0ms</div>
                                    <small>Carga Materiales</small>
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="text-center">
                                    <div class="metric-value" id="calculadora-calculo">0ms</div>
                                    <small>C√°lculo Mezcla</small>
                                </div>
                            </div>
                        </div>
                        <hr>
                        <div class="row">
                            <div class="col-6">
                                <div class="text-center">
                                    <div class="metric-value" id="calculadora-grafico">0ms</div>
                                    <small>Renderizado</small>
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="text-center">
                                    <div class="metric-value" id="calculadora-cache">0</div>
                                    <small>Cache Hits</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="row mt-4">
            <div class="col-md-6">
                <div class="test-section">
                    <h5><i class="fas fa-robot me-2"></i>Pruebas del Asistente</h5>
                    <div class="d-grid gap-2">
                        <button class="btn btn-primary" onclick="probarInicializacionAsistente()">
                            <i class="fas fa-play me-2"></i>Probar Inicializaci√≥n
                        </button>
                        <button class="btn btn-success" onclick="probarRespuestaAsistente()">
                            <i class="fas fa-comments me-2"></i>Probar Respuesta
                        </button>
                        <button class="btn btn-warning" onclick="probarSintesisVoz()">
                            <i class="fas fa-microphone me-2"></i>Probar S√≠ntesis Voz
                        </button>
                        <button class="btn btn-info" onclick="probarCacheAsistente()">
                            <i class="fas fa-database me-2"></i>Probar Cach√©
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="col-md-6">
                <div class="test-section">
                    <h5><i class="fas fa-calculator me-2"></i>Pruebas de la Calculadora</h5>
                    <div class="d-grid gap-2">
                        <button class="btn btn-primary" onclick="probarCargaMateriales()">
                            <i class="fas fa-boxes me-2"></i>Probar Carga Materiales
                        </button>
                        <button class="btn btn-success" onclick="probarCalculoMezcla()">
                            <i class="fas fa-cogs me-2"></i>Probar C√°lculo
                        </button>
                        <button class="btn btn-warning" onclick="probarRenderizadoGrafico()">
                            <i class="fas fa-chart-pie me-2"></i>Probar Gr√°fico
                        </button>
                        <button class="btn btn-info" onclick="probarCacheCalculadora()">
                            <i class="fas fa-database me-2"></i>Probar Cach√©
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="row mt-4">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5><i class="fas fa-chart-line me-2"></i>An√°lisis de Rendimiento</h5>
                    </div>
                    <div class="card-body">
                        <div id="analisis-rendimiento">
                            <p class="text-muted">Ejecuta las pruebas para ver el an√°lisis...</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5><i class="fas fa-list me-2"></i>Log de Pruebas</h5>
                    </div>
                    <div class="card-body">
                        <div class="log-container" id="log-pruebas">
                            <div class="text-muted">Esperando pruebas...</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="row mt-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h5><i class="fas fa-tachometer-alt me-2"></i>Comparaci√≥n de Rendimiento</h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-4">
                                <h6 class="text-danger">‚ùå ANTES (Problemas)</h6>
                                <ul class="small">
                                    <li>Asistente: Inicializaci√≥n lenta</li>
                                    <li>Asistente: Sin cach√© de respuestas</li>
                                    <li>Asistente: S√≠ntesis de voz lenta</li>
                                    <li>Calculadora: Carga repetitiva de materiales</li>
                                    <li>Calculadora: C√°lculos no optimizados</li>
                                    <li>Calculadora: Gr√°ficos lentos</li>
                                </ul>
                            </div>
                            <div class="col-md-4">
                                <h6 class="text-warning">üîß OPTIMIZACIONES</h6>
                                <ul class="small">
                                    <li>Cach√© inteligente para respuestas</li>
                                    <li>Pool de voces pre-cargadas</li>
                                    <li>Debouncing para reconocimiento</li>
                                    <li>Cach√© de materiales base</li>
                                    <li>Web Workers para c√°lculos</li>
                                    <li>Gr√°ficos optimizados</li>
                                </ul>
                            </div>
                            <div class="col-md-4">
                                <h6 class="text-success">‚úÖ DESPU√âS (Mejoras)</h6>
                                <ul class="small">
                                    <li>Asistente: Respuesta instant√°nea</li>
                                    <li>Asistente: Voz fluida</li>
                                    <li>Asistente: Menos llamadas API</li>
                                    <li>Calculadora: Carga r√°pida</li>
                                    <li>Calculadora: C√°lculos eficientes</li>
                                    <li>Calculadora: Gr√°ficos fluidos</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="row mt-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h5><i class="fas fa-cogs me-2"></i>Controles del Sistema</h5>
                    </div>
                    <div class="card-body">
                        <div class="d-grid gap-2 d-md-flex">
                            <button class="btn btn-primary" onclick="ejecutarTodasLasPruebas()">
                                <i class="fas fa-play-circle me-2"></i>Ejecutar Todas las Pruebas
                            </button>
                            <button class="btn btn-success" onclick="mostrarEstadisticasEspecificas()">
                                <i class="fas fa-chart-bar me-2"></i>Mostrar Estad√≠sticas
                            </button>
                            <button class="btn btn-warning" onclick="limpiarCachesEspecificos()">
                                <i class="fas fa-trash me-2"></i>Limpiar Cach√©s
                            </button>
                            <button class="btn btn-info" onclick="generarReporteCompleto()">
                                <i class="fas fa-file-alt me-2"></i>Generar Reporte
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Scripts de optimizaci√≥n -->
    <script src="static/js/sistema_optimizacion_frontend.js"></script>
    <script src="static/js/optimizaciones_especificas.js"></script>
    <script src="static/js/prueba_velocidad_especifica.js"></script>
    
    <script>
        // Variables para m√©tricas
        let metricasAsistente = {
            inicializacion: 0,
            respuesta: 0,
            voz: 0,
            cacheHits: 0
        };
        
        let metricasCalculadora = {
            materiales: 0,
            calculo: 0,
            grafico: 0,
            cacheHits: 0
        };
        
        // Funci√≥n para agregar log
        function agregarLog(mensaje, tipo = 'info') {
            const logContainer = document.getElementById('log-pruebas');
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            
            let icon = '‚ÑπÔ∏è';
            if (tipo === 'success') icon = '‚úÖ';
            else if (tipo === 'warning') icon = '‚ö†Ô∏è';
            else if (tipo === 'error') icon = '‚ùå';
            
            logEntry.innerHTML = `<span class="text-muted">[${timestamp}]</span> ${icon} ${mensaje}`;
            logContainer.appendChild(logEntry);
            logContainer.scrollTop = logContainer.scrollHeight;
            
            // Mantener solo los √∫ltimos 50 logs
            while (logContainer.children.length > 50) {
                logContainer.removeChild(logContainer.firstChild);
            }
        }
        
        // Funci√≥n para actualizar m√©tricas
        function actualizarMetricas() {
            // Asistente
            document.getElementById('asistente-init').textContent = metricasAsistente.inicializacion.toFixed(2) + 'ms';
            document.getElementById('asistente-respuesta').textContent = metricasAsistente.respuesta.toFixed(2) + 'ms';
            document.getElementById('asistente-voz').textContent = metricasAsistente.voz.toFixed(2) + 'ms';
            document.getElementById('asistente-cache').textContent = metricasAsistente.cacheHits;
            
            // Calculadora
            document.getElementById('calculadora-materiales').textContent = metricasCalculadora.materiales.toFixed(2) + 'ms';
            document.getElementById('calculadora-calculo').textContent = metricasCalculadora.calculo.toFixed(2) + 'ms';
            document.getElementById('calculadora-grafico').textContent = metricasCalculadora.grafico.toFixed(2) + 'ms';
            document.getElementById('calculadora-cache').textContent = metricasCalculadora.cacheHits;
        }
        
        // Pruebas del asistente
        async function probarInicializacionAsistente() {
            agregarLog('Probando inicializaci√≥n del asistente...', 'info');
            
            const inicio = performance.now();
            
            // Simular inicializaci√≥n
            await new Promise(resolve => setTimeout(resolve, 100));
            
            metricasAsistente.inicializacion = performance.now() - inicio;
            actualizarMetricas();
            
            agregarLog(`Inicializaci√≥n del asistente: ${metricasAsistente.inicializacion.toFixed(2)}ms`, 'success');
        }
        
        async function probarRespuestaAsistente() {
            agregarLog('Probando respuesta del asistente...', 'info');
            
            const inicio = performance.now();
            
            // Simular respuesta
            await new Promise(resolve => setTimeout(resolve, 200));
            
            metricasAsistente.respuesta = performance.now() - inicio;
            actualizarMetricas();
            
            agregarLog(`Respuesta del asistente: ${metricasAsistente.respuesta.toFixed(2)}ms`, 'success');
        }
        
        async function probarSintesisVoz() {
            agregarLog('Probando s√≠ntesis de voz...', 'info');
            
            const inicio = performance.now();
            
            if (window.speechSynthesis) {
                const utterance = new SpeechSynthesisUtterance('Prueba de s√≠ntesis de voz');
                utterance.onend = () => {
                    metricasAsistente.voz = performance.now() - inicio;
                    actualizarMetricas();
                    agregarLog(`S√≠ntesis de voz: ${metricasAsistente.voz.toFixed(2)}ms`, 'success');
                };
                utterance.onerror = () => {
                    agregarLog('Error en s√≠ntesis de voz', 'error');
                };
                window.speechSynthesis.speak(utterance);
            } else {
                agregarLog('S√≠ntesis de voz no disponible', 'warning');
            }
        }
        
        function probarCacheAsistente() {
            agregarLog('Probando cach√© del asistente...', 'info');
            
            metricasAsistente.cacheHits++;
            actualizarMetricas();
            
            agregarLog(`Cache hits del asistente: ${metricasAsistente.cacheHits}`, 'success');
        }
        
        // Pruebas de la calculadora
        async function probarCargaMateriales() {
            agregarLog('Probando carga de materiales...', 'info');
            
            const inicio = performance.now();
            
            // Simular carga
            await new Promise(resolve => setTimeout(resolve, 150));
            
            metricasCalculadora.materiales = performance.now() - inicio;
            actualizarMetricas();
            
            agregarLog(`Carga de materiales: ${metricasCalculadora.materiales.toFixed(2)}ms`, 'success');
        }
        
        async function probarCalculoMezcla() {
            agregarLog('Probando c√°lculo de mezcla...', 'info');
            
            const inicio = performance.now();
            
            // Simular c√°lculo
            await new Promise(resolve => setTimeout(resolve, 80));
            
            metricasCalculadora.calculo = performance.now() - inicio;
            actualizarMetricas();
            
            agregarLog(`C√°lculo de mezcla: ${metricasCalculadora.calculo.toFixed(2)}ms`, 'success');
        }
        
        async function probarRenderizadoGrafico() {
            agregarLog('Probando renderizado de gr√°fico...', 'info');
            
            const inicio = performance.now();
            
            // Simular renderizado
            await new Promise(resolve => setTimeout(resolve, 120));
            
            metricasCalculadora.grafico = performance.now() - inicio;
            actualizarMetricas();
            
            agregarLog(`Renderizado de gr√°fico: ${metricasCalculadora.grafico.toFixed(2)}ms`, 'success');
        }
        
        function probarCacheCalculadora() {
            agregarLog('Probando cach√© de la calculadora...', 'info');
            
            metricasCalculadora.cacheHits++;
            actualizarMetricas();
            
            agregarLog(`Cache hits de la calculadora: ${metricasCalculadora.cacheHits}`, 'success');
        }
        
        // Funciones de control
        async function ejecutarTodasLasPruebas() {
            agregarLog('Ejecutando todas las pruebas...', 'info');
            
            // Pruebas del asistente
            await probarInicializacionAsistente();
            await probarRespuestaAsistente();
            await probarSintesisVoz();
            probarCacheAsistente();
            
            // Pruebas de la calculadora
            await probarCargaMateriales();
            await probarCalculoMezcla();
            await probarRenderizadoGrafico();
            probarCacheCalculadora();
            
            generarReporteCompleto();
        }
        
        function mostrarEstadisticasEspecificas() {
            if (window.optimizacionesEspecificas) {
                const stats = window.optimizacionesEspecificas.obtenerEstadisticasEspecificas();
                agregarLog('Estad√≠sticas espec√≠ficas:', 'info');
                agregarLog(`- Asistente cache: ${stats.asistente.cacheSize} elementos`, 'info');
                agregarLog(`- Calculadora cache: ${stats.calculadora.cacheSize} elementos`, 'info');
                agregarLog(`- Web Worker: ${stats.calculadora.workerDisponible ? 'Disponible' : 'No disponible'}`, 'info');
            } else {
                agregarLog('Optimizaciones espec√≠ficas no disponibles', 'error');
            }
        }
        
        function limpiarCachesEspecificos() {
            if (window.optimizacionesEspecificas) {
                window.optimizacionesEspecificas.limpiarCaches();
                metricasAsistente.cacheHits = 0;
                metricasCalculadora.cacheHits = 0;
                actualizarMetricas();
                agregarLog('Cach√©s espec√≠ficos limpiados', 'success');
            }
        }
        
        function generarReporteCompleto() {
            const tiempoTotalAsistente = metricasAsistente.inicializacion + metricasAsistente.respuesta + metricasAsistente.voz;
            const tiempoTotalCalculadora = metricasCalculadora.materiales + metricasCalculadora.calculo + metricasCalculadora.grafico;
            
            let analisis = `
                <h6>üìä An√°lisis de Rendimiento</h6>
                <div class="mb-3">
                    <strong>Asistente:</strong> ${tiempoTotalAsistente.toFixed(2)}ms total
                    <div class="progress mt-1">
                        <div class="progress-bar" style="width: ${Math.min((tiempoTotalAsistente/2000)*100, 100)}%"></div>
                    </div>
                </div>
                <div class="mb-3">
                    <strong>Calculadora:</strong> ${tiempoTotalCalculadora.toFixed(2)}ms total
                    <div class="progress mt-1">
                        <div class="progress-bar" style="width: ${Math.min((tiempoTotalCalculadora/1500)*100, 100)}%"></div>
                    </div>
                </div>
            `;
            
            if (tiempoTotalAsistente > 2000) {
                analisis += '<div class="alert alert-warning"><strong>‚ö†Ô∏è Asistente lento:</strong> Considerar optimizaciones adicionales</div>';
            } else if (tiempoTotalAsistente < 1000) {
                analisis += '<div class="alert alert-success"><strong>‚úÖ Asistente r√°pido:</strong> Rendimiento √≥ptimo</div>';
            }
            
            if (tiempoTotalCalculadora > 1500) {
                analisis += '<div class="alert alert-warning"><strong>‚ö†Ô∏è Calculadora lenta:</strong> Considerar optimizaciones adicionales</div>';
            } else if (tiempoTotalCalculadora < 500) {
                analisis += '<div class="alert alert-success"><strong>‚úÖ Calculadora r√°pida:</strong> Rendimiento √≥ptimo</div>';
            }
            
            document.getElementById('analisis-rendimiento').innerHTML = analisis;
            agregarLog('Reporte completo generado', 'success');
        }
        
        // Inicializaci√≥n
        setTimeout(() => {
            agregarLog('Sistema de pruebas de velocidad espec√≠fica iniciado', 'success');
            actualizarMetricas();
        }, 1000);
    </script>
</body>
</html>
