<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Análisis Económico - SIBIA</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/analisis_economico.css') }}">
</head>
<body>
    <div class="container-fluid">
        <!-- Header -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <div>
                            <h1 class="mb-0"><i class="fas fa-chart-line"></i> Análisis Económico</h1>
                            <p class="mb-0 mt-2">Sistema Inteligente de Biogás Avanzado</p>
                        </div>
                        <div class="no-print">
                            <button class="btn btn-light" onclick="location.href='/dashboard_hibrido'">
                                <i class="fas fa-arrow-left"></i> Volver
                            </button>
                            <button class="btn btn-light" onclick="window.print()">
                                <i class="fas fa-print"></i> Imprimir
                            </button>
                            <button class="btn btn-success" onclick="cargarAnalisis()">
                                <i class="fas fa-sync-alt"></i> Actualizar
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Loading -->
        <div class="loading" id="loading">
            <div class="spinner-border text-primary" role="status"></div>
            <p class="mt-3">Calculando análisis económico...</p>
        </div>

        <!-- Content -->
        <div id="content" style="display: none;">
            <!-- Métricas Principales -->
            <div class="row mb-4">
                <div class="col-lg-3 col-md-6 mb-3">
                    <div class="metric-card">
                        <div class="icon-box success"><i class="fas fa-dollar-sign"></i></div>
                        <div class="metric-label">Ingresos Diarios</div>
                        <div class="metric-value positive" id="ingresos-dia">$0</div>
                        <div class="metric-subtitle">
                            Mensual: <span id="ingresos-mes">$0</span><br>
                            Anual: <span id="ingresos-ano">$0</span>
                        </div>
                    </div>
                </div>

                <div class="col-lg-3 col-md-6 mb-3">
                    <div class="metric-card">
                        <div class="icon-box danger"><i class="fas fa-money-bill-wave"></i></div>
                        <div class="metric-label">Costos Diarios</div>
                        <div class="metric-value negative" id="costos-dia">$0</div>
                        <div class="metric-subtitle">
                            Mensual: <span id="costos-mes">$0</span><br>
                            Anual: <span id="costos-ano">$0</span>
                        </div>
                    </div>
                </div>

                <div class="col-lg-3 col-md-6 mb-3">
                    <div class="metric-card">
                        <div class="icon-box info"><i class="fas fa-hand-holding-usd"></i></div>
                        <div class="metric-label">Utilidad Neta</div>
                        <div class="metric-value neutral" id="utilidad-dia">$0</div>
                        <div class="metric-subtitle">
                            Mensual: <span id="utilidad-mes">$0</span><br>
                            Anual: <span id="utilidad-ano">$0</span>
                        </div>
                    </div>
                </div>

                <div class="col-lg-3 col-md-6 mb-3">
                    <div class="metric-card">
                        <div class="icon-box warning"><i class="fas fa-percentage"></i></div>
                        <div class="metric-label">Margen de Utilidad</div>
                        <div class="metric-value" id="margen-utilidad">0%</div>
                        <div class="metric-subtitle">ROI: <span id="roi-anos">0</span> años</div>
                    </div>
                </div>
            </div>

            <!-- Tabs de Análisis -->
            <div class="row">
                <div class="col-12">
                    <div class="card">
                        <div class="card-body">
                            <ul class="nav nav-tabs" id="analysisTabs" role="tablist">
                                <li class="nav-item">
                                    <button class="nav-link active" id="resumen-tab" data-bs-toggle="tab" data-bs-target="#resumen" type="button">
                                        <i class="fas fa-chart-pie"></i> Resumen
                                    </button>
                                </li>
                                <li class="nav-item">
                                    <button class="nav-link" id="sustratos-tab" data-bs-toggle="tab" data-bs-target="#sustratos" type="button">
                                        <i class="fas fa-seedling"></i> Sustratos
                                    </button>
                                </li>
                                <li class="nav-item">
                                    <button class="nav-link" id="ahorro-tab" data-bs-toggle="tab" data-bs-target="#ahorro" type="button">
                                        <i class="fas fa-piggy-bank"></i> Ahorro SA7
                                    </button>
                                </li>
                                <li class="nav-item">
                                    <button class="nav-link" id="operativos-tab" data-bs-toggle="tab" data-bs-target="#operativos" type="button">
                                        <i class="fas fa-cogs"></i> Costos Operativos
                                    </button>
                                </li>
                                <li class="nav-item">
                                    <button class="nav-link" id="capex-tab" data-bs-toggle="tab" data-bs-target="#capex" type="button">
                                        <i class="fas fa-industry"></i> CAPEX/OPEX
                                    </button>
                                </li>
                            </ul>

                            <div class="tab-content mt-4" id="analysisTabsContent">
                                <!-- Tab Resumen -->
                                <div class="tab-pane fade show active" id="resumen">
                                    <div class="row">
                                        <div class="col-lg-6 mb-4">
                                            <h5><i class="fas fa-chart-bar"></i> Distribución de Costos</h5>
                                            <canvas id="chartCostos"></canvas>
                                        </div>
                                        <div class="col-lg-6 mb-4">
                                            <h5><i class="fas fa-chart-line"></i> Flujo de Caja Anual</h5>
                                            <canvas id="chartFlujo"></canvas>
                                        </div>
                                    </div>
                                </div>

                                <!-- Tab Sustratos -->
                                <div class="tab-pane fade" id="sustratos">
                                    <h5><i class="fas fa-list"></i> Detalle de Sustratos Utilizados</h5>
                                    <div class="table-responsive">
                                        <table class="table table-striped table-hover">
                                            <thead>
                                                <tr>
                                                    <th>Sustrato</th>
                                                    <th>TN/Día</th>
                                                    <th>Precio $/TN</th>
                                                    <th>Costo Diario</th>
                                                    <th>KW Generados</th>
                                                    <th>TN SA7 Equiv.</th>
                                                    <th>Ahorro vs SA7</th>
                                                </tr>
                                            </thead>
                                            <tbody id="tablaSustratos">
                                                <tr><td colspan="7" class="text-center">Cargando...</td></tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>

                                <!-- Tab Ahorro SA7 -->
                                <div class="tab-pane fade" id="ahorro">
                                    <div class="row">
                                        <div class="col-lg-4 mb-3">
                                            <div class="metric-card">
                                                <div class="icon-box success"><i class="fas fa-weight"></i></div>
                                                <div class="metric-label">TN SA7 Ahorradas/Día</div>
                                                <div class="metric-value positive" id="tn-sa7-dia">0</div>
                                                <div class="metric-subtitle">
                                                    Mes: <span id="tn-sa7-mes">0</span> TN<br>
                                                    Año: <span id="tn-sa7-ano">0</span> TN
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-lg-4 mb-3">
                                            <div class="metric-card">
                                                <div class="icon-box success"><i class="fas fa-dollar-sign"></i></div>
                                                <div class="metric-label">Ahorro Diario</div>
                                                <div class="metric-value positive" id="ahorro-usd-dia">$0</div>
                                                <div class="metric-subtitle">
                                                    Mes: <span id="ahorro-usd-mes">$0</span><br>
                                                    Año: <span id="ahorro-usd-ano">$0</span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-lg-4 mb-3">
                                            <div class="metric-card">
                                                <div class="icon-box info"><i class="fas fa-tag"></i></div>
                                                <div class="metric-label">Precio SA7</div>
                                                <div class="metric-value neutral" id="precio-sa7">$45</div>
                                                <div class="metric-subtitle">USD por tonelada</div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="alert alert-success">
                                        <h5><i class="fas fa-info-circle"></i> Análisis de Ahorro</h5>
                                        <p>El reemplazo de Silo 7 (SA7) por otros sustratos genera ahorro. SA7 cuesta $45/TN, maximizar uso de Purín (sin costo) y otros sustratos reduce costos operativos.</p>
                                    </div>
                                </div>

                                <!-- Tab Costos Operativos -->
                                <div class="tab-pane fade" id="operativos">
                                    <h5><i class="fas fa-calculator"></i> Desglose de Costos Operativos (OPEX)</h5>
                                    <div class="table-responsive">
                                        <table class="table table-striped">
                                            <thead>
                                                <tr><th>Concepto</th><th>Diario</th><th>Mensual</th><th>Anual</th></tr>
                                            </thead>
                                            <tbody>
                                                <tr><td><i class="fas fa-bolt"></i> Electricidad</td><td id="elec-dia">$0</td><td id="elec-mes">$0</td><td id="elec-ano">$0</td></tr>
                                                <tr><td><i class="fas fa-users"></i> Mano de Obra</td><td id="mano-dia">$0</td><td id="mano-mes">$0</td><td id="mano-ano">$0</td></tr>
                                                <tr><td><i class="fas fa-wrench"></i> Mantenimiento</td><td id="mant-dia">$0</td><td id="mant-mes">$0</td><td id="mant-ano">$0</td></tr>
                                                <tr><td><i class="fas fa-shield-alt"></i> Seguros</td><td id="seg-dia">$0</td><td id="seg-mes">$0</td><td id="seg-ano">$0</td></tr>
                                                <tr><td><i class="fas fa-briefcase"></i> Administrativos</td><td id="admin-dia">$0</td><td id="admin-mes">$0</td><td id="admin-ano">$0</td></tr>
                                                <tr class="table-primary fw-bold"><td>TOTAL OPEX</td><td id="opex-dia">$0</td><td id="opex-mes">$0</td><td id="opex-ano">$0</td></tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>

                                <!-- Tab CAPEX/OPEX -->
                                <div class="tab-pane fade" id="capex">
                                    <h5><i class="fas fa-industry"></i> Análisis CAPEX y Retorno de Inversión</h5>
                                    <div class="row">
                                        <div class="col-lg-3 mb-3">
                                            <div class="metric-card">
                                                <div class="icon-box info"><i class="fas fa-building"></i></div>
                                                <div class="metric-label">Inversión Inicial</div>
                                                <div class="metric-value neutral" id="inversion-inicial">$0</div>
                                                <div class="metric-subtitle">CAPEX</div>
                                            </div>
                                        </div>
                                        <div class="col-lg-3 mb-3">
                                            <div class="metric-card">
                                                <div class="icon-box warning"><i class="fas fa-calendar"></i></div>
                                                <div class="metric-label">Vida Útil</div>
                                                <div class="metric-value" id="vida-util">20</div>
                                                <div class="metric-subtitle">años</div>
                                            </div>
                                        </div>
                                        <div class="col-lg-3 mb-3">
                                            <div class="metric-card">
                                                <div class="icon-box success"><i class="fas fa-chart-line"></i></div>
                                                <div class="metric-label">VAN</div>
                                                <div class="metric-value positive" id="van">$0</div>
                                                <div class="metric-subtitle">Valor Actual Neto</div>
                                            </div>
                                        </div>
                                        <div class="col-lg-3 mb-3">
                                            <div class="metric-card">
                                                <div class="icon-box success"><i class="fas fa-percent"></i></div>
                                                <div class="metric-label">TIR</div>
                                                <div class="metric-value positive" id="tir">0%</div>
                                                <div class="metric-subtitle">Tasa Interna Retorno</div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="alert alert-info mt-3">
                                        <h6><i class="fas fa-lightbulb"></i> Indicadores Financieros</h6>
                                        <ul class="mb-0">
                                            <li><strong>VAN Positivo:</strong> El proyecto es rentable</li>
                                            <li><strong>TIR > Tasa Descuento:</strong> Supera expectativas</li>
                                            <li><strong>ROI:</strong> Tiempo recuperación inversión</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="{{ url_for('static', filename='js/analisis_economico.js') }}"></script>
</body>
</html>
