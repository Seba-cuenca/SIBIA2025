SIBIA_ML_SYSTEM/
â”œâ”€â”€ core/                    # 4 archivos principales
â”œâ”€â”€ api/                     # 5 blueprints de Flask
â”œâ”€â”€ data/                    # JSONs persistentes
â”œâ”€â”€ templates/               # HTML
â”œâ”€â”€ static/                  # CSS/JS
â”œâ”€â”€ app.py
â”œâ”€â”€ config.py
â””â”€â”€ requirements.txt



Integra el sistema SIBIA ML completo en mi aplicaciÃ³n Flask existente.

ARCHIVOS A INTEGRAR:
1. core/asistente_sibia_definitivo.py
2. core/sistema_aprendizaje_continuo.py  
3. core/sistema_formulas_calculos.py
4. core/sistema_comparacion_graficos.py
5. services/web_voice_system.py

TAREAS:
1. Crear estructura de carpetas segÃºn ESTRUCTURA_PROYECTO_SIBIA.md
2. Adaptar ToolContext en asistente_sibia_definitivo.py con mis funciones reales:
   - obtener_stock_actual()
   - obtener_mezcla_calculada()
   - leer_sensor_plc()
3. Registrar blueprints en app.py
4. Crear endpoints API segÃºn routes_*.py
5. Verificar que las dependencias de requirements.txt estÃ©n instaladas

PUNTOS CRÃTICOS:
- Asegurar que ToolContext tenga acceso real a stock, mezclas y sensores
- No sobrescribir mis rutas existentes
- Mantener compatibilidad con mi sistema actual


# ğŸ“ ESTRUCTURA DEL PROYECTO SIBIA

## Estructura de Carpetas

```
SIBIA_ML_SYSTEM/
â”‚
â”œâ”€â”€ ğŸ“ core/                              # MÃ³dulos principales
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ asistente_sibia_definitivo.py    # Asistente principal con todos los modelos
â”‚   â”œâ”€â”€ sistema_aprendizaje_continuo.py  # Sistema de aprendizaje del usuario
â”‚   â”œâ”€â”€ sistema_formulas_calculos.py     # Sistema de fÃ³rmulas y cÃ¡lculos
â”‚   â””â”€â”€ sistema_comparacion_graficos.py  # ComparaciÃ³n de escenarios y grÃ¡ficos
â”‚
â”œâ”€â”€ ğŸ“ ml_models/                         # Modelos de Machine Learning
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ modelo_xgboost.py                # Predicciones con XGBoost
â”‚   â”œâ”€â”€ algoritmo_genetico.py           # OptimizaciÃ³n con AG
â”‚   â”œâ”€â”€ optimizacion_bayesiana.py       # OptimizaciÃ³n Bayesiana
â”‚   â””â”€â”€ sistema_cain.py                  # Sistema CAIN para sensores
â”‚
â”œâ”€â”€ ğŸ“ services/                          # Servicios adicionales
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ busqueda_web.py                  # BÃºsqueda en internet
â”‚   â”œâ”€â”€ sistema_clima.py                 # InformaciÃ³n del clima
â”‚   â”œâ”€â”€ personalizacion.py               # Sistema de personalizaciÃ³n
â”‚   â””â”€â”€ web_voice_system.py              # Sistema de voz web
â”‚
â”œâ”€â”€ ğŸ“ api/                               # Endpoints Flask
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ routes_chat.py                   # Rutas del chat
â”‚   â”œâ”€â”€ routes_aprendizaje.py            # Rutas de aprendizaje
â”‚   â”œâ”€â”€ routes_escenarios.py             # Rutas de escenarios
â”‚   â”œâ”€â”€ routes_graficos.py               # Rutas de grÃ¡ficos
â”‚   â””â”€â”€ routes_estadisticas.py           # Rutas de estadÃ­sticas
â”‚
â”œâ”€â”€ ğŸ“ data/                              # Datos persistentes
â”‚   â”œâ”€â”€ conocimiento_sibia.json          # Base de conocimiento aprendido
â”‚   â”œâ”€â”€ escenarios_sibia.json            # Escenarios guardados
â”‚   â”œâ”€â”€ usuario_sibia.json               # Datos del usuario
â”‚   â”œâ”€â”€ asistente_ml_completo.json       # Cache del asistente
â”‚   â””â”€â”€ voice_config.json                # ConfiguraciÃ³n de voz
â”‚
â”œâ”€â”€ ğŸ“ static/                            # Archivos estÃ¡ticos
â”‚   â”œâ”€â”€ css/
â”‚   â”‚   â””â”€â”€ sibia_styles.css
â”‚   â”œâ”€â”€ js/
â”‚   â”‚   â”œâ”€â”€ sibia_chat.js
â”‚   â”‚   â”œâ”€â”€ sibia_escenarios.js
â”‚   â”‚   â””â”€â”€ sibia_graficos.js
â”‚   â””â”€â”€ images/
â”‚       â””â”€â”€ logo_sibia.png
â”‚
â”œâ”€â”€ ğŸ“ templates/                         # Templates HTML
â”‚   â”œâ”€â”€ base.html
â”‚   â”œâ”€â”€ chat.html
â”‚   â”œâ”€â”€ dashboard.html
â”‚   â”œâ”€â”€ escenarios.html
â”‚   â””â”€â”€ aprendizaje.html
â”‚
â”œâ”€â”€ ğŸ“ tests/                             # Tests
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ test_asistente.py
â”‚   â”œâ”€â”€ test_aprendizaje.py
â”‚   â””â”€â”€ test_formulas.py
â”‚
â”œâ”€â”€ ğŸ“ docs/                              # DocumentaciÃ³n
â”‚   â”œâ”€â”€ README.md
â”‚   â”œâ”€â”€ INSTALACION.md
â”‚   â”œâ”€â”€ API_REFERENCE.md
â”‚   â””â”€â”€ EJEMPLOS.md
â”‚
â”œâ”€â”€ app.py                                # AplicaciÃ³n Flask principal
â”œâ”€â”€ config.py                             # ConfiguraciÃ³n
â”œâ”€â”€ requirements.txt                      # Dependencias
â””â”€â”€ .env.example                          # Variables de entorno ejemplo

```

---

## ğŸ“„ Contenido de Archivos Principales

### 1. `requirements.txt`

```txt
# Framework
Flask==2.3.0
Flask-CORS==4.0.0

# Machine Learning
numpy==1.24.3
scikit-learn==1.3.0
xgboost==2.0.0

# GrÃ¡ficos
matplotlib==3.7.1

# Web y APIs
requests==2.31.0
beautifulsoup4==4.12.2

# Voz
gtts==2.3.2
edge-tts==6.1.9

# Utilidades
python-dotenv==1.0.0
```

---

### 2. `config.py`

```python
import os
from dotenv import load_dotenv

load_dotenv()

class Config:
    # Flask
    SECRET_KEY = os.getenv('SECRET_KEY', 'dev-secret-key-change-in-production')
    DEBUG = os.getenv('DEBUG', 'True') == 'True'
    
    # APIs
    WEATHER_API_KEY = os.getenv('WEATHER_API_KEY', '')
    
    # Rutas de datos
    DATA_DIR = os.path.join(os.path.dirname(__file__), 'data')
    
    # Sistema de voz
    VOICE_ENABLED = os.getenv('VOICE_ENABLED', 'True') == 'True'
    VOICE_LANGUAGE = os.getenv('VOICE_LANGUAGE', 'es')
    
    # Machine Learning
    ML_MODELS_DIR = os.path.join(os.path.dirname(__file__), 'ml_models', 'trained')
    
    # Logs
    LOG_LEVEL = os.getenv('LOG_LEVEL', 'INFO')
```

---

### 3. `app.py`

```python
#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
SIBIA - Sistema Inteligente de BiogÃ¡s con IA Avanzada
AplicaciÃ³n Flask Principal
"""

from flask import Flask, render_template, jsonify
from flask_cors import CORS
import logging
from config import Config

# Importar blueprints
from api.routes_chat import chat_bp
from api.routes_aprendizaje import aprendizaje_bp
from api.routes_escenarios import escenarios_bp
from api.routes_graficos import graficos_bp
from api.routes_estadisticas import estadisticas_bp

# Configurar logging
logging.basicConfig(
    level=logging.INFO,
    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s'
)
logger = logging.getLogger(__name__)

def create_app(config_class=Config):
    """Factory para crear la aplicaciÃ³n Flask"""
    app = Flask(__name__)
    app.config.from_object(config_class)
    
    # CORS
    CORS(app)
    
    # Registrar blueprints
    app.register_blueprint(chat_bp, url_prefix='/api/chat')
    app.register_blueprint(aprendizaje_bp, url_prefix='/api/aprendizaje')
    app.register_blueprint(escenarios_bp, url_prefix='/api/escenarios')
    app.register_blueprint(graficos_bp, url_prefix='/api/graficos')
    app.register_blueprint(estadisticas_bp, url_prefix='/api/estadisticas')
    
    # Ruta principal
    @app.route('/')
    def index():
        return render_template('chat.html')
    
    @app.route('/dashboard')
    def dashboard():
        return render_template('dashboard.html')
    
    @app.route('/escenarios')
    def escenarios():
        return render_template('escenarios.html')
    
    @app.route('/health')
    def health():
        return jsonify({'status': 'ok', 'version': '5.0'})
    
    logger.info("SIBIA inicializado correctamente")
    return app

if __name__ == '__main__':
    app = create_app()
    app.run(host='0.0.0.0', port=5000, debug=True)
```

---

### 4. `.env.example`

```env
# ConfiguraciÃ³n de Flask
SECRET_KEY=tu-secret-key-aqui
DEBUG=True

# APIs Externas
WEATHER_API_KEY=tu-api-key-openweathermap

# Sistema de Voz
VOICE_ENABLED=True
VOICE_LANGUAGE=es

# Logs
LOG_LEVEL=INFO

# Base de datos (si usas)
DATABASE_URL=sqlite:///sibia.db
```

---

### 5. `api/__init__.py`

```python
"""
API Endpoints para SIBIA
"""
```

---

### 6. `api/routes_chat.py`

```python
from flask import Blueprint, request, jsonify
from core.asistente_sibia_definitivo import asistente_sibia_definitivo
from core.sistema_aprendizaje_continuo import sistema_aprendizaje

chat_bp = Blueprint('chat', __name__)

@chat_bp.route('/mensaje', methods=['POST'])
def procesar_mensaje():
    """Procesa un mensaje del usuario"""
    data = request.get_json()
    pregunta = data.get('pregunta', '')
    
    if not pregunta:
        return jsonify({'error': 'Pregunta vacÃ­a'}), 400
    
    # Buscar en conocimiento aprendido primero
    conocimiento = sistema_aprendizaje.buscar_conocimiento(pregunta)
    
    if conocimiento:
        return jsonify({
            'respuesta': conocimiento.respuesta_correcta,
            'motor': 'APRENDIZAJE_CONTINUO',
            'confianza': conocimiento.confianza,
            'aprendido': True
        })
    
    # Usar asistente SIBIA
    # TODO: Construir contexto con tus datos reales
    resultado = asistente_sibia_definitivo.procesar_pregunta(pregunta)
    
    return jsonify(resultado)
```

---

### 7. `api/routes_aprendizaje.py`

```python
from flask import Blueprint, request, jsonify
from core.sistema_aprendizaje_continuo import sistema_aprendizaje

aprendizaje_bp = Blueprint('aprendizaje', __name__)

@aprendizaje_bp.route('/corregir', methods=['POST'])
def corregir_respuesta():
    """Permite al usuario corregir una respuesta"""
    data = request.get_json()
    
    exito = sistema_aprendizaje.agregar_correccion(
        pregunta=data['pregunta'],
        respuesta_original=data['respuesta_incorrecta'],
        respuesta_correcta=data['respuesta_correcta'],
        contexto=data.get('contexto')
    )
    
    return jsonify({
        'exito': exito,
        'mensaje': 'Â¡Gracias! He aprendido esta correcciÃ³n.' if exito else 'Error'
    })

@aprendizaje_bp.route('/estadisticas', methods=['GET'])
def obtener_estadisticas():
    """EstadÃ­sticas del sistema de aprendizaje"""
    return jsonify(sistema_aprendizaje.obtener_estadisticas())
```

---

### 8. `api/routes_escenarios.py`

```python
from flask import Blueprint, request, jsonify
from core.sistema_comparacion_graficos import sistema_comparacion

escenarios_bp = Blueprint('escenarios', __name__)

@escenarios_bp.route('/crear', methods=['POST'])
def crear_escenario():
    """Crea un nuevo escenario"""
    data = request.get_json()
    
    escenario = sistema_comparacion.crear_escenario(
        nombre=data['nombre'],
        descripcion=data.get('descripcion', ''),
        parametros=data['parametros'],
        resultado=data['resultado'],
        unidad=data['unidad'],
        tipo_calculo=data['tipo_calculo']
    )
    
    return jsonify({'exito': True, 'escenario_id': escenario.id})

@escenarios_bp.route('/listar', methods=['GET'])
def listar_escenarios():
    """Lista escenarios"""
    tipo = request.args.get('tipo')
    escenarios = sistema_comparacion.listar_escenarios(tipo)
    return jsonify({'escenarios': escenarios})

@escenarios_bp.route('/comparar', methods=['POST'])
def comparar_escenarios():
    """Compara escenarios"""
    data = request.get_json()
    ids = data.get('ids_escenarios', [])
    
    comparacion = sistema_comparacion.comparar_escenarios(ids)
    return jsonify(comparacion)
```

---

### 9. `api/routes_graficos.py`

```python
from flask import Blueprint, request, jsonify
from core.sistema_comparacion_graficos import sistema_graficos

graficos_bp = Blueprint('graficos', __name__)

@graficos_bp.route('/comparacion', methods=['POST'])
def grafico_comparacion():
    """Genera grÃ¡fico de comparaciÃ³n"""
    data = request.get_json()
    grafico = sistema_graficos.generar_grafico_comparacion(data['escenarios'])
    return jsonify({'grafico': grafico})

@graficos_bp.route('/prediccion', methods=['POST'])
def grafico_prediccion():
    """Genera grÃ¡fico de predicciÃ³n"""
    data = request.get_json()
    grafico = sistema_graficos.generar_grafico_prediccion(
        data['temperatura'],
        data['presion'],
        data['prediccion']
    )
    return jsonify({'grafico': grafico})
```

---

### 10. `docs/INSTALACION.md`

```markdown
# InstalaciÃ³n de SIBIA

## Requisitos Previos

- Python 3.8 o superior
- pip
- virtualenv (recomendado)

## InstalaciÃ³n

### 1. Clonar/Copiar archivos

Coloca todos los archivos en una carpeta llamada `SIBIA_ML_SYSTEM/`

### 2. Crear entorno virtual

```bash
python -m venv venv
source venv/bin/activate  # Linux/Mac
venv\Scripts\activate     # Windows
```

### 3. Instalar dependencias

```bash
pip install -r requirements.txt
```

### 4. Configurar variables de entorno

```bash
cp .env.example .env
# Editar .env con tus configuraciones
```

### 5. Ejecutar aplicaciÃ³n

```bash
python app.py
```

La aplicaciÃ³n estarÃ¡ disponible en: http://localhost:5000

## IntegraciÃ³n con tu sistema existente

Para integrar con tu aplicaciÃ³n Flask existente:

1. Copia la carpeta `core/` a tu proyecto
2. Copia la carpeta `api/` a tu proyecto
3. Registra los blueprints en tu `app.py`
4. Adapta las rutas segÃºn tu estructura

```python
from api.routes_chat import chat_bp
app.register_blueprint(chat_bp, url_prefix='/api/chat')
```
```

---

## ğŸ“ Instrucciones para Cursor

Crea un archivo `INSTRUCCIONES_CURSOR.md`:

```markdown
# Instrucciones para Cursor AI

## Objetivo
Integrar el sistema SIBIA ML completo en la aplicaciÃ³n Flask existente.

## Tareas

### 1. Estructura de carpetas
- Crear carpetas: `core/`, `ml_models/`, `services/`, `api/`
- Mover archivos segÃºn la estructura definida

### 2. Adaptar ToolContext
- Localizar dÃ³nde obtienes: stock, mezclas, sensores
- Reemplazar en `asistente_sibia_definitivo.py` las funciones placeholder con las reales

### 3. Integrar blueprints
- Registrar todos los blueprints en tu `app.py` principal
- Ajustar prefijos de URLs segÃºn tu convenciÃ³n

### 4. ConfiguraciÃ³n
- Agregar variables de entorno en `.env`
- Configurar API de clima (opcional)

### 5. Frontend
- Integrar templates HTML en tu carpeta `templates/`
- Ajustar rutas de assets (CSS/JS)

### 6. Testing
- Probar endpoint `/api/chat/mensaje`
- Probar sistema de aprendizaje
- Verificar generaciÃ³n de grÃ¡ficos

## Puntos crÃ­ticos a revisar

1. **ToolContext**: Asegurarse de que tenga acceso real a:
   - `stock_materiales_actual`
   - `mezcla_diaria_calculada`
   - `_obtener_valor_sensor_func` (lectura PLC)

2. **Rutas**: Verificar que las URLs no colisionen con tu sistema

3. **Base de datos**: Si usas DB, adaptar persistencia de escenarios/aprendizaje

4. **AutenticaciÃ³n**: Agregar decoradores de autenticaciÃ³n si es necesario
```

---

## âœ… Checklist Final

```markdown
# Checklist de IntegraciÃ³n

- [ ] Estructura de carpetas creada
- [ ] Dependencias instaladas
- [ ] Archivos core/ copiados
- [ ] Blueprints registrados
- [ ] ToolContext adaptado a datos reales
- [ ] Variables de entorno configuradas
- [ ] Templates integrados
- [ ] Assets (CSS/JS) copiados
- [ ] Test de endpoints exitoso
- [ ] Sistema de voz funcionando
- [ ] GrÃ¡ficos generÃ¡ndose correctamente
- [ ] Aprendizaje continuo guardando
- [ ] ComparaciÃ³n de escenarios operativa
```

Â¿Quieres que genere algÃºn archivo adicional o necesitas mÃ¡s detalles sobre alguna parte especÃ­fica?