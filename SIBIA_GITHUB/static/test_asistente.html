<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prueba Asistente IA</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        #conversation { border: 1px solid #ccc; height: 300px; overflow-y: auto; padding: 10px; margin-bottom: 10px; }
        .user { text-align: right; color: blue; }
        .assistant { text-align: left; color: green; }
        .error { color: red; }
        input { width: 80%; padding: 8px; }
        button { padding: 8px 15px; }
    </style>
</head>
<body>
    <h1>Prueba de Asistente IA</h1>
    <div id="conversation"></div>
    <div>
        <input type="text" id="question" placeholder="Escribe tu pregunta aquí...">
        <button id="send">Enviar</button>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const conversation = document.getElementById('conversation');
            const questionInput = document.getElementById('question');
            const sendButton = document.getElementById('send');

            function addMessage(text, sender) {
                const messageDiv = document.createElement('div');
                messageDiv.className = sender;
                messageDiv.textContent = `${sender === 'user' ? 'Tú' : 'Asistente'}: ${text}`;
                conversation.appendChild(messageDiv);
                conversation.scrollTop = conversation.scrollHeight;
            }

            function sendQuestion() {
                const question = questionInput.value.trim();
                if (!question) return;

                addMessage(question, 'user');
                questionInput.value = '';

                // Usamos window.location.origin que ya incluye el protocolo + dominio + puerto
                const url = window.location.origin + '/ask_assistant';
                console.log("URL completa:", url);  // Depuración: mostrar la URL completa

                fetch(url, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ pregunta: question })
                })
                .then(response => {
                    console.log("Respuesta del servidor:", response);  // Depuración
                    if (!response.ok) {
                        throw new Error(`Error HTTP: ${response.status}`);
                    }
                    return response.json();
                })
                .then(data => {
                    console.log("Datos recibidos:", data);  // Depuración
                    addMessage(data.respuesta || 'No se recibió respuesta.', 'assistant');
                })
                .catch(error => {
                    console.error("Error en fetch:", error);  // Depuración
                    const errorDiv = document.createElement('div');
                    errorDiv.className = 'error';
                    errorDiv.textContent = `Error: ${error.message}`;
                    conversation.appendChild(errorDiv);
                    conversation.scrollTop = conversation.scrollHeight;
                });
            }

            sendButton.addEventListener('click', sendQuestion);
            questionInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') sendQuestion();
            });
        });
    </script>
</body>
</html> 