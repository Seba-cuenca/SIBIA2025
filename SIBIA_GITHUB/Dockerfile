# Dockerfile para SIBIA desplegado desde subcarpeta SIBIA_GITHUB
# Optimizado para Google Cloud Run

FROM python:3.10-slim

ENV PYTHONUNBUFFERED=1 \
    PYTHONDONTWRITEBYTECODE=1 \
    PORT=8080 \
    HOST=0.0.0.0 \
    DEBUG=false

RUN apt-get update && apt-get install -y \
    gcc \
    g++ \
    git \
    && rm -rf /var/lib/apt/lists/*

WORKDIR /app

# Copiar requirements espec√≠ficos de la subcarpeta
COPY requirements.txt ./requirements.txt
RUN pip install --no-cache-dir -r requirements.txt

# Copiar solo el contenido de SIBIA_GITHUB
COPY . .

RUN mkdir -p ml_training_data models logs reportes

EXPOSE 8080

HEALTHCHECK --interval=30s --timeout=10s --start-period=40s --retries=3 \
    CMD python -c "import requests; requests.get('http://localhost:8080/health', timeout=5)"

CMD exec gunicorn --bind :$PORT --workers 2 --threads 4 --timeout 300 --access-logfile - --error-logfile - --log-level info app_CORREGIDO_OK_FINAL:app
